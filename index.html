<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>QR Notes</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    #qrcode canvas { margin: 1rem 0; }
    textarea { width: 100%; height: 200px; font-size: 1rem; padding: 0.5rem; }
  </style>
</head>
<body>
  <h1>QR Notes</h1>
  <p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –Ω—ë–º.</p>
  <div id="qrcode"></div>
  <textarea id="editor" placeholder="–û–∂–∏–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è..."></textarea>

  <script>
    const editor = document.getElementById('editor');

    // üëâ –£–ö–ê–ñ–ò –ó–î–ï–°–¨ –°–í–û–ô –†–ï–ê–õ–¨–ù–´–ô Render-—Å–µ—Ä–≤–µ—Ä
    const backendURL = 'https://qr-sync-server.onrender.com'; // –∑–∞–º–µ–Ω–∏—à—å –Ω–∞ —Å–≤–æ–π

    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
    fetch(`${backendURL}/session`)
      .then(res => res.json())
      .then(({ sessionId }) => {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        QRCode.toCanvas(document.getElementById('qrcode'), sessionId);

        // –°–æ–∑–¥–∞—ë–º WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        const ws = new WebSocket(backendURL.replace('http', 'ws'));

        ws.onopen = () => {
          ws.send(JSON.stringify({ type: 'join', sessionId }));
        };

        ws.onmessage = (msg) => {
          const data = JSON.parse(msg.data);
          if (data.type === 'init' || data.type === 'update') {
            editor.value = data.text;
          }
        };

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞
        editor.addEventListener('input', () => {
          ws.send(JSON.stringify({ type: 'update', text: editor.value }));
        });
      });
  </script>
</body>
</html>
